<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Distributed System: Primary Backup Replication - Junyi&rsquo;s Lab</title>
<meta name=description content="å¼€èƒƒèœæ¥äº†ï¼
ä½ æœ‰ä¸€ä¸ªç¡¬ç›˜ï¼Œå­˜äº†å¾ˆå¤šé‡è¦èµ„æ–™ï¼Œä½ æ‹…å¿ƒè¿™ä¸ªç¡¬ç›˜æŸå¤©åäº†ï¼Œæ€ä¹ˆåŠï¼Ÿ
å½“ç„¶æ˜¯å¤šä¹°ç‚¹ç¡¬ç›˜ï¼ŒæŠŠæ•°æ®å¤‡ä»½åœ¨ä¸åŒçš„ç¡¬ç›˜ä¸Šã€‚"><link rel=icon type=image/x-icon href=https://www.junyi.dev/favicon.ico><link rel=apple-touch-icon-precomposed href=https://www.junyi.dev/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=https://www.junyi.dev/css/style.min.eaefe0f95d1fe64ef0a3932347fc8e07ff4e3de4515423d0ad22b33474042778.css integrity="sha256-6u/g+V0f5k7wo5MjR/yOB/9OPeRRVCPQrSKzNHQEJ3g="><script src=https://www.junyi.dev/js/script.min.74bf1a3fcf1af396efa4acf3e660e876b61a2153ab9cbe1893ac24ea6d4f94ee.js type=text/javascript integrity="sha256-dL8aP88a85bvpKzz5mDodrYaIVOrnL4Yk6wk6m1PlO4="></script><script async defer data-website-id=dd99a470-c29d-4882-8c6a-89f1cec9045c data-cache=false data-do-not-track=false src=https://analytics.eu.umami.is/script.js></script></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=/>Junyi's Lab</a></h1><ul class=social-icons><li><a href=https://github.com/Junyi-99 title=Github rel=me><span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li></ul></div><nav><a href=https://www.junyi.dev/ title>Home</a>
<a href=https://www.junyi.dev/tags/ title>Tags</a>
<a href=https://www.junyi.dev/posts/ title>Archive</a>
<a href=https://www.junyi.dev/about/ title>About</a></nav><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">Distributed System: Primary Backup Replication</h1></header></div><nav id=TableOfContents><ul><li><a href=#å‰æå‡è®¾>å‰æå‡è®¾</a></li><li><a href=#æœ€ç®€å•çš„-primary--backup>æœ€ç®€å•çš„ primary & backup</a></li><li><a href=#ä»€ä¹ˆæ˜¯-view-server-é‡Œçš„-view>ä»€ä¹ˆæ˜¯ view-server é‡Œçš„ view</a></li><li><a href=#æ€»ç»“ä¸€ä¸‹æ‰€æœ‰çš„è§„åˆ™>æ€»ç»“ä¸€ä¸‹æ‰€æœ‰çš„è§„åˆ™</a></li><li><a href=#è„‘è£‚-split-brain>è„‘è£‚ (Split-brain)</a></li><li><a href=#ç³»ç»Ÿå¡ä½>ç³»ç»Ÿå¡ä½</a></li><li><a href=#é‡å¤å†™å…¥>é‡å¤å†™å…¥</a></li><li><a href=#ä¸ºä»€ä¹ˆ-primary-backup-æ¯”è¾ƒéš¾>ä¸ºä»€ä¹ˆ Primary Backup æ¯”è¾ƒéš¾</a></li><li><a href=#æ€»ç»“ä¸€ä¸‹-view-server-çš„ç¼ºç‚¹>æ€»ç»“ä¸€ä¸‹ view-server çš„ç¼ºç‚¹</a></li><li><a href=#rubyçŠ¶æ€æœºå¤åˆ¶rtstate-machine-replicationrtruby><ruby>çŠ¶æ€æœºå¤åˆ¶<rt>State Machine Replication</rt></ruby></a></li></ul></nav><div class="content e-content"><p>å¼€èƒƒèœæ¥äº†ï¼</p><p>ä½ æœ‰ä¸€ä¸ªç¡¬ç›˜ï¼Œå­˜äº†å¾ˆå¤šé‡è¦èµ„æ–™ï¼Œä½ æ‹…å¿ƒè¿™ä¸ªç¡¬ç›˜æŸå¤©åäº†ï¼Œæ€ä¹ˆåŠï¼Ÿ</p><p>å½“ç„¶æ˜¯å¤šä¹°ç‚¹ç¡¬ç›˜ï¼ŒæŠŠæ•°æ®å¤‡ä»½åœ¨ä¸åŒçš„ç¡¬ç›˜ä¸Šã€‚</p><p>ä¿è¯å¯é ï¼Œå°±æ˜¯é€šè¿‡å¤šä¸ªä¸€è‡´çš„æ•°æ®å‰¯æœ¬æ¥å®ç°çš„ã€‚</p><hr><h2 id=å‰æå‡è®¾>å‰æå‡è®¾
<span><a href=#%e5%89%8d%e6%8f%90%e5%81%87%e8%ae%be><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>æˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯<ruby>ç¡®å®š<rt>deterministic</rt></ruby>çš„</p><h2 id=æœ€ç®€å•çš„-primary--backup>æœ€ç®€å•çš„ primary & backup
<span><a href=#%e6%9c%80%e7%ae%80%e5%8d%95%e7%9a%84-primary--backup><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ol><li>client<strong>s</strong> å‘é€ operation (Put, Get, Append) åˆ° primary-server</li><li>primary-server å†³å®š operation çš„æ‰§è¡Œé¡ºåº</li><li>primary-server æŠŠ operation çš„æ‰§è¡Œé¡ºåºå‘é€ç»™ backup-server</li><li>backup-server æŒ‰ç…§ primary-server å‘é€çš„é¡ºåºæ‰§è¡Œ operation ï¼ˆhot-standbyï¼‰<ul><li>æˆ–è€… backup-server æŒ‰ç…§ primary-server å‘é€çš„é¡ºåºè®°å½• operation ä½†ä¸æ‰§è¡Œï¼ˆcold-standbyï¼‰</li></ul></li><li>ç­‰ backup-server æˆåŠŸç»“æŸï¼Œprimary-server ç»™ client å‘å›å¤</li></ol><p><strong>é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆå†³å®šè°æ¥å½“ primary-serverï¼Ÿ</strong></p><p><strong>æ€ä¹ˆå†³å®šè°æ¥å½“ backup-serverï¼Ÿ</strong></p><p><strong>client æ€ä¹ˆçŸ¥é“è°æ˜¯ primary-serverï¼Ÿ</strong></p><p><strong>ç­”æ¡ˆï¼š</strong> <span class=spoiler>å¼•å…¥ä¸€å° view-serverï¼Œè®©è¿™ä¸ª view-server æ¥åšå†³å®šï¼Œå¹¶ä¸” client å»é—® view-server è°æ˜¯ primary-serverã€‚ä¸ºä»€ä¹ˆå«å®ƒ view-server ï¼Ÿ å› ä¸ºè¿™æ¶‰åŠåˆ°ä¸€ä¸ªé‡è¦æ¦‚å¿µã€Œviewã€ï¼Œåé¢ä¼šè®²åˆ°ï¼Œåˆ«ç€æ€¥ï¼</span></p><p>çŸ¥é“äº†ç­”æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¾è®¡æ•´ä¸ªç³»ç»Ÿï¼š</p><ul><li><p>æˆ‘ä»¬è®©æ¯å°æœåŠ¡å™¨å‘é€å¿ƒè·³ç»™ view-serverï¼Œå‘Šè¯‰ view-server è‡ªå·±è¿˜æ´»ç€ã€‚</p><p>é—®ï¼šæœ‰æ²¡æœ‰å¯èƒ½è‡ªå·±æ´»ç€ä½†æ˜¯ view-server è®¤ä¸ºè‡ªå·±æ­»äº†ï¼Ÿ<span class=spoiler> æœ‰å¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œå¿ƒè·³æ²¡å‘å‡ºå»ï¼Œ view-server è®¤ä¸ºèŠ‚ç‚¹æŒ‚äº†ï¼Œä½†å…¶å®èŠ‚ç‚¹è¿˜æ´»ç€</span></p></li><li><p>æˆ‘ä»¬ promote idle-server æˆä¸º backup-serverï¼Œä½†ä¸è¶Šçº§ promote æˆä¸º primary-server</p><p>é—®ï¼šé™¤éæœ‰ç§æƒ…å†µï¼Ÿ<span class=spoiler>ç³»ç»Ÿåˆšå¯åŠ¨æ—¶ï¼ˆå…¨éƒ½æ˜¯ idle-serverã€éœ€è¦ä¸€ä¸ª primary çš„æ—¶å€™ï¼‰</span></p></li><li><p>åªæœ‰ backup-server ä¼šè¢« promote æˆ primary-server</p></li></ul><figure><img src=view-service.png alt="View Service" width=500><figcaption>Fig.1 - One View Server and Two Nodes</figcaption></figure><h2 id=ä»€ä¹ˆæ˜¯-view-server-é‡Œçš„-view>ä»€ä¹ˆæ˜¯ view-server é‡Œçš„ view
<span><a href=#%e4%bb%80%e4%b9%88%e6%98%af-view-server-%e9%87%8c%e7%9a%84-view><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>ä¸€ä¸ª view æ˜¯ä¸€ä¸ª primary-server å’Œä¸€ä¸ª backup-server çš„é›†åˆï¼Œæè¿°äº†å½“å‰çŠ¶æ€<strong>è°æ˜¯ primary è°æ˜¯ backup</strong>ã€‚</p><p>æ³¨æ„ï¼Œä¸€ä¸ª view é‡Œï¼Œåªæœ‰ä¸€ä¸ª primary å’Œä¸€ä¸ª backupï¼Œå…¶å®ƒçš„ server æ ‡è®°ä¸º idleã€‚ï¼ˆæƒ³æƒ³çœ‹ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿï¼‰</p><p>view ç”± view-server è¿›è¡Œç®¡ç†ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥è·å–åˆ°å½“å‰ç³»ç»Ÿçš„ viewã€‚</p><figure><img src=view.png alt=view-service width=400><figcaption>Fig.2 - Example of three different views, denotes three different states of the system</figcaption></figure><p><strong>çœ‹äº†ä¸Šé¢çš„æè¿°ï¼Œæ„Ÿè§‰è‡ªå·±åˆè¡Œäº†ï¼Œäºæ˜¯æˆ‘è®¾è®¡å‡ºäº†ä¸‹é¢çš„æµç¨‹</strong></p><blockquote><p>ç³»ç»Ÿåˆšå¼€å§‹ï¼ŒæŒ‘ä¸€ä¸ª primary-serverï¼Œç„¶åæŒ‘ä¸€ä¸ª backup-serverï¼Œå…¶å®ƒçš„éƒ½æ˜¯ idle-serverï¼Œç„¶åå¼€å§‹å·¥ä½œã€‚</p><p>primary ç«‹é©¬è®© backup æˆä¸ºæ–°çš„ primaryï¼Œä» idle é‡Œé¢æŒ‘ä¸€ä¸ªæˆä¸º backupï¼Œç„¶åè®©è¿™ä¸ªæ–°çš„ primary æŠŠçŠ¶æ€éƒ½å‘é€ç»™ backup</p></blockquote><p><strong>å¾ˆç®€å•å˜›ï¼è¿™èƒ½æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>è¯éŸ³åˆšè½ï¼Œé—®é¢˜å°±æ¥äº†ã€‚</p><p>è¯·çœ‹ä¸‹é¢è¿™ä¸ªæƒ…å†µï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span><span style=color:#e6db74>`View 1, primary=A, backup=B;`</span> è¿™æ—¶å€™ A æŒ‚äº†ï¼ŒB æˆä¸º primaryï¼Œä» idle é‡Œé¢æŒ‘ä¸€ä¸ª C æˆä¸º backupï¼Œç„¶å B å‘é€çŠ¶æ€ç»™ Cã€‚
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`View 2, primary=B, backup=C;`</span> B å‘çŠ¶æ€çš„æ—¶å€™æŒ‚äº†ï¼ŒC æˆä¸º primaryï¼Œidle é‡Œé¢æ²¡æœºå™¨äº†
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`View 3, primary=C, backup=_;`</span> Cï¼šğŸ˜…ï¼Ÿï¼ˆæ­¤æ—¶ C æ ¹æœ¬ä¸çŸ¥é“ç³»ç»Ÿçš„çŠ¶æ€æ˜¯ä»€ä¹ˆï¼‰
</span></span></code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬åˆšåˆšå¯¹æ•´ä¸ªç³»ç»Ÿçš„æè¿°ï¼Œæ˜¯æœ‰ç¼ºé™·çš„ã€‚</p><p>æ€ä¹ˆæ”¹å‘¢ï¼Œæˆ‘ä»¬è®© view-server å¿…é¡»ç­‰å¾… primary-server <ruby>ç¡®è®¤<rt>ACK</rt></ruby> å½“å‰çš„ viewã€‚</p><p>å°±ç®— primary-server æŒ‚äº†ï¼Œview-server ä¹Ÿè¦ç­‰ ACKã€‚</p><p>ï¼ˆç›´è§‰å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ç§ç­‰å¾… ACK çš„è¡Œä¸ºå¯èƒ½å¯¼è‡´ç³»ç»Ÿå¡ä½ï¼‰</p><h2 id=æ€»ç»“ä¸€ä¸‹æ‰€æœ‰çš„è§„åˆ™>æ€»ç»“ä¸€ä¸‹æ‰€æœ‰çš„è§„åˆ™
<span><a href=#%e6%80%bb%e7%bb%93%e4%b8%80%e4%b8%8b%e6%89%80%e6%9c%89%e7%9a%84%e8%a7%84%e5%88%99><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ol><li><p>åœ¨ view i+1 çš„ primary å¿…é¡»æ˜¯ view i çš„ backup</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ä¼šæ€æ ·ï¼Ÿ<span class=spoiler><strong>Split brain:</strong> primary A, backup B, but can&rsquo;t reach view-server. C,D are promoted to primary and backup, C doesn&rsquo;t know previous state.</span></p></li><li><p>primary å¿…é¡»ç­‰ backup æ‰§è¡Œå®Œï¼Œæ‰å¯ä»¥å›å¤ client</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ä¼šæ€æ ·ï¼Ÿ<span class=spoiler><strong>Missing write:</strong> client writes to Aï¼ŒA crashes before writing to B, clients read from B</span></p><p>ä¸€å®šè¦è½¬å‘ read() ç»™ backup å—ï¼Ÿï¼ˆè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æ“ä½œï¼‰<span class=spoiler>å¿…é¡»è½¬å‘ã€‚ä¸ç„¶å¯èƒ½å‡ºç° <strong>Stale read</strong>: at <em>view 1</em>, A,B are primary and backup, but A cannot reach view-server. now <em>view 2</em>, B,C are primary backup. client 1 writes to B, client 2 reads from A. A returns outdated data ï¼ˆä¸è¿‡ stale read ä¾ç„¶ç¬¦åˆ sequential consistencyï¼‰</span></p></li><li><p>å¦‚æœ view æ˜¯æ­£ç¡®çš„ï¼Œbackup å¿…é¡»æ¥å—<ruby>è½¬å‘çš„è¯·æ±‚<rt>Forwarded Request</rt></ruby>ï¼Œå¹¶ä¸”æ‰§è¡Œ</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ä¼šæ€æ ·ï¼Ÿ<span class=spoiler><strong>Partially Split Brain</strong></span></p></li><li><p>non-primary èŠ‚ç‚¹<strong>å¿…é¡»æ‹’ç»</strong> client çš„è¯·æ±‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ä¼šæ€æ ·ï¼Ÿ<span class=spoiler><strong>Inconsistencies:</strong> client&rsquo;s view may outdated, send request to old primary server.</span></p></li><li><p>state-transfer çš„æ—¶å€™ä¸èƒ½æœ‰æ“ä½œã€‚ï¼ˆAtomic State Transferï¼‰</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ä¼šæ€æ ·ï¼Ÿ<span class=spoiler></span></p></li></ol><h2 id=è„‘è£‚-split-brain>è„‘è£‚ (Split-brain)
<span><a href=#%e8%84%91%e8%a3%82-split-brain><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>è¿™ä¸ªè¯æœ‰ç‚¹å“äººã€‚ã€‚ã€‚å…¶å®æ˜¯åœ¨è¯´ï¼š<strong>åœ¨ç½‘ç»œæ•…éšœæ—¶ï¼Œä¸¤ä¸ªåŠä»¥ä¸Šçš„èŠ‚ç‚¹éƒ½è®¤ä¸ºè‡ªå·±æ˜¯ Leader (primary-server)ã€‚</strong></p><blockquote><p>View 1, primary=A, backup=B; è¿™æ—¶å€™ A ç½‘ç»œå‡ºæ•…éšœæ— æ³•è¿æ¥åˆ° view-serverï¼ŒB æˆä¸ºæ–°çš„ primaryã€‚
View 2, primary=B, backup=_; B æ˜¯ æ–°çš„ primaryï¼Œä½† A ä¹Ÿè®¤ä¸ºè‡ªå·±æ˜¯ primary</p></blockquote><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„è§„å®šé‡Œï¼Œåªæœ‰ primary-server ä¼šå›å¤ clientï¼Œä½†æ˜¯è„‘è£‚çš„æ—¶å€™ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¼šå›å¤ clientï¼Œè¿™å°±å¯èƒ½å¯¼è‡´ client æ”¶åˆ°çš„æ•°æ®ä¸ä¸€è‡´ã€‚
ï¼ˆç ´åäº† Linearzabilityï¼‰</p><h2 id=ç³»ç»Ÿå¡ä½>ç³»ç»Ÿå¡ä½
<span><a href=#%e7%b3%bb%e7%bb%9f%e5%8d%a1%e4%bd%8f><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>æœ‰å“ªäº›å¯èƒ½å¯¼è‡´ç³»ç»Ÿå¡ä½ï¼ˆå¤„ç†ä¸äº† client çš„è¯·æ±‚ï¼‰çš„æƒ…å†µï¼Ÿ</p><ol><li>view-server æŒ‚äº†</li><li>æ•´ä¸ªç½‘ç»œæŒ‚äº†</li><li>client åªèƒ½ç»ƒåˆ° view-serverï¼Œä¸èƒ½è¿æ¥åˆ° primary-server</li><li>backup server æ²¡æœ‰äº†ï¼ˆå› ä¸º primary è½¬ç§»çŠ¶æ€ç»™ backupï¼Œè½¬ç§»å®Œäº†å›å¤ view-server ä¸€ä¸ª ACKï¼‰</li><li>çŠ¶æ€è½¬ç§»ä¹‹å‰ primary æŒ‚äº†</li></ol><h2 id=é‡å¤å†™å…¥>é‡å¤å†™å…¥
<span><a href=#%e9%87%8d%e5%a4%8d%e5%86%99%e5%85%a5><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><h2 id=ä¸ºä»€ä¹ˆ-primary-backup-æ¯”è¾ƒéš¾>ä¸ºä»€ä¹ˆ Primary Backup æ¯”è¾ƒéš¾
<span><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88-primary-backup-%e6%af%94%e8%be%83%e9%9a%be><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ul><li>primary å¯èƒ½æŒ‚æ‰</li><li>backup å¯èƒ½æŒ‚æ‰</li><li>é€šè®¯å¯èƒ½ ä¸´æ—¶/æ°¸ä¹… æŒ‚æ‰</li><li>å‚ä¸è€…çš„å†³ç­–å¯èƒ½å­˜åœ¨å»¶è¿Ÿï¼š<ul><li>view server ä¸çŸ¥é“ primary æŒ‚äº†</li><li>primary æŒ‚äº†å—ï¼ŸæŒ‚äº†ä¹‹åæ¢å¤ï¼Œè¿˜éœ€è¦å›å¤ client å—ï¼Ÿ</li><li>backup æŒ‚äº†å—ï¼Ÿstate transfer ç»“æŸäº†å—ï¼Ÿ</li><li>client ä¸çŸ¥é“ view æœ‰æ²¡æœ‰åˆ‡æ¢</li></ul></li></ul><h2 id=æ€»ç»“ä¸€ä¸‹-view-server-çš„ç¼ºç‚¹>æ€»ç»“ä¸€ä¸‹ view-server çš„ç¼ºç‚¹
<span><a href=#%e6%80%bb%e7%bb%93%e4%b8%80%e4%b8%8b-view-server-%e7%9a%84%e7%bc%ba%e7%82%b9><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><ol><li>view-server è‡ªå·±å­˜åœ¨å•ç‚¹æ•…éšœé—®é¢˜</li><li>view-server å¿…é¡»ç­‰å¾… primary çš„ ackï¼Œå³ä½¿ primary å¯èƒ½æŒ‚äº†ä¹Ÿè¦ç­‰</li></ol><h2 id=rubyçŠ¶æ€æœºå¤åˆ¶rtstate-machine-replicationrtruby><ruby>çŠ¶æ€æœºå¤åˆ¶<rt>State Machine Replication</rt></ruby>
<span><a href=#ruby%e7%8a%b6%e6%80%81%e6%9c%ba%e5%a4%8d%e5%88%b6rtstate-machine-replicationrtruby><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><blockquote><p><strong>çŠ¶æ€æœºæœ‰ä¸€ä¸ªç‰¹æ€§ï¼š</strong> ä»»ä½•åˆå§‹çŠ¶æ€ä¸€æ ·çš„çŠ¶æ€æœºï¼Œå¦‚æœæ‰§è¡Œçš„å‘½ä»¤åºåˆ—ä¸€æ ·ï¼Œåˆ™æœ€ç»ˆè¾¾åˆ°çš„çŠ¶æ€ä¹Ÿä¸€æ ·ã€‚</p><p>å¦‚æœå°†æ­¤ç‰¹æ€§åº”ç”¨åœ¨å¤šå‚ä¸è€…è¿›è¡Œåå•†å…±è¯†ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªå…·æœ‰å®Œå…¨ç›¸åŒçš„çŠ¶æ€æœºï¼ˆå‚ä¸è€…ï¼‰ï¼Œè¿™äº›çŠ¶æ€æœºèƒ½æœ€ç»ˆä¿æŒä¸€è‡´çš„å…³é”®å°±æ˜¯èµ·å§‹çŠ¶æ€å®Œå…¨ä¸€è‡´å’Œæ‰§è¡Œå‘½ä»¤åºåˆ—å®Œå…¨ä¸€è‡´ã€‚</p></blockquote><p>æ ¹æ®çŠ¶æ€æœºçš„ç‰¹æ€§ï¼Œè¦è®©å¤šå°æœºå™¨çš„æœ€ç»ˆçŠ¶æ€ä¸€è‡´ï¼Œåªè¦ç¡®ä¿å®ƒä»¬çš„åˆå§‹çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”æ¥æ”¶åˆ°çš„æ“ä½œæŒ‡ä»¤åºåˆ—ä¹Ÿæ˜¯ä¸€è‡´çš„å³å¯ï¼Œæ— è®ºè¿™ä¸ªæ“ä½œæŒ‡ä»¤æ˜¯æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤æŠ‘æˆ–æ˜¯å…¶ä»–ä»»ä½•å¯èƒ½çš„ç¨‹åºè¡Œä¸ºï¼Œéƒ½å¯ä»¥ç†è§£ä¸ºè¦å°†ä¸€è¿ä¸²çš„æ“ä½œæ—¥å¿—æ­£ç¡®åœ°å¹¿æ’­ç»™å„ä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ã€‚</p><p>æˆ‘ä»¬å¹¶ä¸è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹çš„æ¯ä¸€æ¡æŒ‡ä»¤éƒ½æ˜¯åŒæ—¶å¼€å§‹ã€åŒæ­¥å®Œæˆçš„ï¼Œåªè¦æ±‚åœ¨æ­¤æœŸé—´çš„å†…éƒ¨çŠ¶æ€ä¸èƒ½è¢«å¤–éƒ¨è§‚å¯Ÿåˆ°ï¼Œä¸”å½“æ“ä½œæŒ‡ä»¤åºåˆ—æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æœ€ç»ˆçš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œè¿™ç§æ¨¡å‹å°±è¢«ç§°ä¸ºçŠ¶æ€æœºå¤åˆ¶ï¼ˆState Machine Replicationï¼‰ã€‚</p><style>.spoiler{visibility:hidden}.spoiler::before{visibility:visible;content:"hover me to see the answer";color:#fff;background-color:#000}.spoiler:hover{visibility:visible}.spoiler:hover::before{display:none}</style></div><div class=post-info><div class="post-date dt-published"><a class=u-url href=/posts/paxos-review-3/><time datetime=2023-09-12>2023-09-12</time></a></div><a class="post-hidden-url u-url" href=https://www.junyi.dev/posts/paxos-review-3/>https://www.junyi.dev/posts/paxos-review-3/</a>
<a href=https://www.junyi.dev/ class="p-name p-author post-hidden-author h-card" rel=me>Junyi Hou</a><div class=post-taxonomies><ul class=post-tags><li><a href>#æŠ€æœ¯æ–‡ç« </a></li><li><a href=https://www.junyi.dev/tags/distributed-system/>#Distributed System</a></li></ul></div></div></article><h3 class=read-next-title>Read next</h3><ul class=read-next-posts><li><a href=/posts/paxos-review-2/>Distributed System: Consistency</a></li><li><a href=/posts/paxos-review-1/>Distributed System: Ordering of events</a></li><li><a href=/posts/ra-experience/>å½“ RA çš„æˆ‘å­¦åˆ°äº†ä»€ä¹ˆï¼šå¦‚ä½•ä¼˜åŒ–å®éªŒæµç¨‹</a></li></ul><script src=https://giscus.app/client.js data-repo=Junyi-99/Junyi-99.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzNDI4ODI3NzY=" data-category=Announcements data-category-id=DIC_kwDOFG_52M4CZZZF data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=en crossorigin=anonymous async></script></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>Â© Junyi Hou, 2023<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div><button class=theme-switcher>
Dark theme
</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage!==null&&localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton&&(switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme")}function switchTheme(){currentTheme=="dark"?(localStorage!==null&&localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage!==null&&localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href=https://www.junyi.dev/ class="p-name u-url url fn" rel=me>Junyi Hou</a>
/
<a class="p-email u-email email" rel=me href=mailto:hhh@u.nus.edu>hhh@u.nus.edu</a></p></footer></div></body></html>