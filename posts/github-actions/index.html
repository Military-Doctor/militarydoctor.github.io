<!doctype html><html lang=zh-cn data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>隐藏 GitHub Pages 里的敏感文章（GitHub Actions） - Junyi&rsquo;s Lab</title><meta name=description content="

    
        #
    
    背景


如何防止他人看到你托管在 GitHub Pages 上的某些文章？
这篇指南提供了一种在 GitHub Pages 上托管网站同时保持敏感内容私密的策略。"><link rel=icon type=image/x-icon href=https://www.junyi.dev/favicon.ico><link rel=apple-touch-icon-precomposed href=https://www.junyi.dev/favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=/css/style.min.184a655c5ad8596648622468e6696abf0cf0a2cf8266df17b4f7a36fe9c97551.css integrity="sha256-GEplXFrYWWZIYiRo5mlqvwzwos+CZt8XtPejb+nJdVE="><link rel=stylesheet href=/css/style.min.c4c04b3ef88e3d619ad4c7ee5e03048422bc55c4fefdc1f07657c1133670aa22.css integrity="sha256-xMBLPviOPWGa1MfuXgMEhCK8VcT+/cHwdlfBEzZwqiI="><link rel=stylesheet href=/css/style.min.21c5d8fe0a79d623b0adc1ce4bd4f6dd2c05cd939c9aaaa966ba7186b1464f4d.css integrity="sha256-IcXY/gp51iOwrcHOS9T23SwFzZOcmqqpZrpxhrFGT00="><script src=/js/script.min.08f04d96386c73c9bf4d160333f8f448c05a6e01c06770542ee0e013954ce930.js type=text/javascript integrity="sha256-CPBNljhsc8m/TRYDM/j0SMBabgHAZ3BULuDgE5VM6TA="></script></head><body><a class=skip-main href=#main>跳至内容</a><div class=container><header class=common-header><div class=header-top><div class=header-top-left><h1 class="site-title noselect"><a href=/>Junyi's Lab</a></h1><div class=theme-switcher><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-sun-high"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14.828 14.828A4 4 0 109.172 9.172a4 4 0 005.656 5.656z"/><path d="M6.343 17.657l-1.414 1.414"/><path d="M6.343 6.343 4.929 4.929"/><path d="M17.657 6.343l1.414-1.414"/><path d="M17.657 17.657l1.414 1.414"/><path d="M4 12H2"/><path d="M12 4V2"/><path d="M20 12h2"/><path d="M12 20v2"/></svg></span></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="light";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");function switchTheme(){currentTheme=currentTheme==="dark"?"light":"dark",localStorage&&localStorage.setItem(STORAGE_KEY,currentTheme),document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))}const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeGiscusTheme(currentTheme),document.body.dispatchEvent(new CustomEvent(currentTheme+"-theme-set"))};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme==="auto"?(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)):document.documentElement.setAttribute("data-theme",currentTheme),switchButton&&switchButton.addEventListener("click",switchTheme,!1),showContent()});function detectCurrentScheme(){return localStorage!==null&&localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}function changeGiscusTheme(e){function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}</script><ul class="social-icons noselect"><li><a href=/index.xml title=RSS rel=me><span class=inline-svg><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></span></a></li></ul></div><div class=header-top-right></div></div><nav class=noselect><a href=https://www.junyi.dev/ title>HOME</a>
<a href=https://www.junyi.dev/tags/ title>TAGS</a>
<a href=https://www.junyi.dev/posts/ title>ARCHIVE</a>
<a href=https://www.junyi.dev/friends/ title>FRIENDS</a>
<a href=https://www.junyi.dev/about/ title>ABOUT</a></nav></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">隐藏 GitHub Pages 里的敏感文章（GitHub Actions）</h1><span><ul class=post-translations><li><a href=/en/posts/github-actions/>EN</a></li><li>ZH-CN</li></ul></span></header><div class="post-info noselect"><div class="post-date dt-published"><time datetime=2024-03-18>2024-03-18</time></div><a class="post-hidden-url u-url" href=/posts/github-actions/>/posts/github-actions/</a>
<a href=https://www.junyi.dev/ class="p-name p-author post-hidden-author h-card" rel=me>map[email:junyi.h@comp.nus.edu.sg name:Junyi Hou]</a><div class=post-taxonomies><ul class=post-tags><li><a href=/tags/techshare/>#TechShare</a></li></ul></div></div></div><details class="toc noselect"><summary>Table of Contents</summary><div class=inner><nav id=TableOfContents><ul><li><a href=#背景>背景</a></li><li><a href=#第一步创建一个-personal-access-token>第一步，创建一个 personal access token</a></li><li><a href=#第二步给-blog-src-创建一个-repository-secret>第二步，给 <code>blog-src</code> 创建一个 repository secret</a></li><li><a href=#第三步给-blog-src-设置一个-workflow>第三步，给 <code>blog-src</code> 设置一个 workflow</a></li><li><a href=#第四步推送到-blog-src>第四步，推送到 <code>blog-src</code></a></li></ul></nav></div></details><script>var toc=document.querySelector(".toc");toc&&toc.addEventListener("click",function(){event.target.tagName!=="A"&&(event.preventDefault(),this.open?(this.open=!1,this.classList.remove("expanded")):(this.open=!0,this.classList.add("expanded")))})</script><div class="content e-content"><h2 id=背景><div><a href=#%e8%83%8c%e6%99%af>#
</a>背景</div></h2><p>如何<strong>防止他人看到你</strong>托管在 GitHub Pages 上的某些文章？</p><p>这篇指南提供了一种在 GitHub Pages 上托管网站同时保持敏感内容私密的策略。</p><p>这个解决方案涉及到使用两个独立的 GitHub 仓库：</p><ul><li><p>私有仓库 <code>blog-src</code>: 存放你的网站源代码。</p></li><li><p>公开仓库 <code>blog.github.io</code>: 用于生成的静态网站。</p></li></ul><p>这个方法确保敏感内容在 <code>blog-src</code> 中保持私密。</p><p>每次对 <code>blog-src</code> 进行提交时，一个自动化过程会构建静态网站并将其推送到 <code>blog.github.io</code>（参见<a href=#fig1>图 1</a>）。</p><figure><img id=fig1 src=/posts/github-actions/fig1.png alt="The Overview of using Github Actions to publish GitHub pages" width=500><figcaption>图 1 - 修改 <code>blog-src</code> 时，自动构建网站并同步到 <code>blog.github.io</code></figcaption></figure><p>让我们看看如何实现这个功能！</p><h2 id=第一步创建一个-personal-access-token><div><a href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-personal-access-token>#
</a>第一步，创建一个 personal access token</div></h2><ol><li><p>访问<a href=https://github.com/settings/tokens>此页面</a>（Settings ➜ Developer Settings ➜ Personal access tokens）</p></li><li><p>Generate new token (classic)</p></li><li><p>勾选所有的 &ldquo;repo&rdquo; 和 &ldquo;workflow&rdquo;。（参见<a href=#fig2>图 2</a>）</p></li></ol><figure><img src=/posts/github-actions/create-personal-key.png alt="View Service" width=500><figcaption>图 2 - 给 GitHub Action 创建一个 personal access token</figcaption></figure><figure><img src=/posts/github-actions/created-token.png alt="View Service" width=500><figcaption>图 3 - 创建好的 personal access token</figcaption></figure><p>复制你生成的 Token，比如我的是 <code>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</code></p><p>（此 Token 仅用作演示，实际已失效）</p><h2 id=第二步给-blog-src-创建一个-repository-secret><div><a href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e7%bb%99-blog-src-%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-repository-secret>#
</a>第二步，给 <code>blog-src</code> 创建一个 repository secret</div></h2><p>这个仓库包含我们网站的源代码，和一个 GitHub Action。</p><p>因此，我们需要把 personal access token（从第一步生成）放到 repository secret 里，以支持 GitHub Action 过程。</p><p>转到 <code>blog-src</code> ➜ Settings ➜ Secrets and variables ➜ Actions ➜ New <strong>repository</strong> secret</p><figure><img src=/posts/github-actions/new-repo-secret.png alt="View Service" width=500><figcaption>图 4 - 创建 repository secret 的入口</figcaption></figure><figure><img src=/posts/github-actions/add-secret.png alt="View Service" width=500><figcaption>图 5 - 创建一个 repository secret</figcaption></figure><h2 id=第三步给-blog-src-设置一个-workflow><div><a href=#%e7%ac%ac%e4%b8%89%e6%ad%a5%e7%bb%99-blog-src-%e8%ae%be%e7%bd%ae%e4%b8%80%e4%b8%aa-workflow>#
</a>第三步，给 <code>blog-src</code> 设置一个 workflow</div></h2><p>Repository ➜ Actions ➜ Set up a workflow yourself</p><figure><img src=/posts/github-actions/setup-actions.png alt="Setup Actions" , width=500><figcaption>图 6 - 设置一个 workflow.</figcaption></figure><p>你需要学习如何编写工作流，以下是一些你可以阅读的文档：</p><ul><li><a href=https://docs.github.com/en/actions/quickstart>GitHub Actions 快速入门</a></li><li><a href=https://docs.github.com/en/actions/examples>工作流示例</a></li></ul><p>仔细设计你的 workflow 文件，这里是一个示例：</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#78787e># main.yaml</span>
</span></span><span style=display:flex><span><span style=color:#78787e># A Sample workflow for building and deploying a site to GitHub Pages</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>name</span>: Deploy Website to Pages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>branches</span>:
</span></span><span style=display:flex><span>      - main <span style=color:#78787e># Triggers this workflow whenever there&#39;s a push to the `main` branch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#78787e># Allows you to run this workflow manually from the Actions tab</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>workflow_dispatch</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>schedule</span>:
</span></span><span style=display:flex><span>    <span style=color:#78787e># Runs at 00:00 UTC every day</span>
</span></span><span style=display:flex><span>    - <span style=color:#ff6ac1>cron</span>: <span style=color:#5af78e>&#34;0 0 * * *&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>contents</span>: read
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>pages</span>: write
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>id-token</span>: write
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.</span>
</span></span><span style=display:flex><span><span style=color:#78787e># However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>concurrency</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>group</span>: <span style=color:#5af78e>&#34;pages&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>cancel-in-progress</span>: <span style=color:#ff6ac1>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#78787e># Default to bash</span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>defaults</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>run</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>shell</span>: bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff6ac1>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>build-and-deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>runs-on</span>: ubuntu-latest
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>env</span>:
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>YOUR_ENV_HERE</span>: <span style=color:#ff9f43>0.1.2.3</span>
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Checkout
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: actions/checkout@v3
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>submodules</span>: recursive
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>fetch-depth</span>: <span style=color:#ff9f43>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Build my website
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>run</span>: |<span style=color:#5af78e>
</span></span></span><span style=display:flex><span><span style=color:#5af78e>          echo &#34;Building the website ... (Remember to replace it with the real command!!!)&#34;</span>          
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#ff6ac1>name</span>: Deploy to GitHub Pages
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>uses</span>: peaceiris/actions-gh-pages@v3
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>personal_token</span>: ${{ secrets.GH_PAGES_PAT }} <span style=color:#78787e># The pre-defined secret in Step 2.</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>publish_dir</span>: ./public  <span style=color:#78787e># Content in this folder will be pushed to the target repo.</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>user_name</span>: <span style=color:#5af78e>&#39;github-actions[bot]&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>user_email</span>: <span style=color:#5af78e>&#39;github-actions[bot]@users.noreply.github.com&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>external_repository</span>: Junyi-99/blog.github.io  <span style=color:#78787e># Your GitHub Pages Repo (target repo)</span>
</span></span><span style=display:flex><span>          <span style=color:#ff6ac1>commit_message</span>: <span style=color:#5af78e>&#39;Automated deployment from Repository blog-src&#39;</span>
</span></span></code></pre></div><h2 id=第四步推送到-blog-src><div><a href=#%e7%ac%ac%e5%9b%9b%e6%ad%a5%e6%8e%a8%e9%80%81%e5%88%b0-blog-src>#
</a>第四步，推送到 <code>blog-src</code></div></h2><p>在这个步骤中，你需要做的就是向 <code>blog-src</code> <strong>推送</strong> 一些提交，如果一切顺利的话，你的 GitHub Actions 将会自动执行，构建你的网站，并将其推送到 <code>blog.github.io</code> 仓库。</p><p>（文章结束）</p></div></article></main><footer class="common-footer noselect"><ul class=language-select><li><a href=/en/posts/github-actions/>English</a></li><li>Simplified Chinese</li></ul><div class=common-footer-bottom><div style=display:flex;align-items:center;gap:8px>© Junyi Hou, 2024</div><div style=display:flex;align-items:center></div><div>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/Junyi-99/hugo-theme-anubis2>Anubis2</a>.<br></div></div><p class="h-card vcard"><a href=https://www.junyi.dev/ class="p-name u-url url fn" rel=me>map[email:junyi.h@comp.nus.edu.sg name:Junyi Hou]</a></p></footer></div></body></html>